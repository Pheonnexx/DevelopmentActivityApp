!function(){"use strict";function t(t){this.$el=o(t.el),this._loadOption(t,"name"),this._loadOption(t,"customVarIndex"),this._loadOption(t,"cohorts"),this._loadOption(t,"runImmediately",!0),this._loadOption(t,"defaultWeight",1),this.runImmediately&&this.run()}window.GOVUK=window.GOVUK||{};var o=window.$;t.prototype._loadOption=function(t,o,i){if(void 0!==t[o]&&(this[o]=t[o]),void 0===this[o]){if(void 0===i)throw new Error(o+" option is required for a multivariate test");this[o]=i}},t.prototype.run=function(){var t=this.getCohort();t&&(this.setCustomVar(t),this.executeCohort(t))},t.prototype.executeCohort=function(t){var o=this.cohorts[t];o.callback&&("string"==typeof o.callback?this[o.callback]():o.callback()),o.html&&(this.$el.html(o.html),this.$el.show())},t.prototype.getCohort=function(){var t=GOVUK.cookie(this.cookieName());return t&&this.cohorts[t]||(t=this.chooseRandomCohort(),GOVUK.cookie(this.cookieName(),t,{days:30})),t},t.prototype.setCustomVar=function(t){window._gaq=window._gaq||[],window._gaq.push(["_setCustomVar",this.customVarIndex,this.cookieName(),t,2]),window._gaq.push(["_trackEvent",this.cookieName(),"run","-",0,!0])},t.prototype.weightedCohortNames=function(){var t=[],i=this.defaultWeight;return o.each(this.cohorts,function(o,e){var h,r;for(h="undefined"==typeof e.weight?i:e.weight,r=0;h>r;r++)t.push(o)}),t},t.prototype.chooseRandomCohort=function(){var t=this.weightedCohortNames();return t[Math.floor(Math.random()*t.length)]},t.prototype.cookieName=function(){return"multivariatetest_cohort_"+this.name},window.GOVUK.MultivariateTest=t}();